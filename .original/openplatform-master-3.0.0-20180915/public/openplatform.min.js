var OPENPLATFORM={};OPENPLATFORM.version='3.0.0',OPENPLATFORM.callbacks={},OPENPLATFORM.events={},OPENPLATFORM.is=top!==window,OPENPLATFORM.pending=[],OPENPLATFORM.interval=setInterval(function(){if(OPENPLATFORM.ready)return clearInterval(OPENPLATFORM.interval),void OPENPLATFORM.pending.forEach(OPENPLATFORM.$process)},500),OPENPLATFORM.screenshot=function(){if(!OPENPLATFORM.$screenshot){var e;window.Promise||((e=document.createElement('script')).type='text/javascript',e.src='//cdnjs.cloudflare.com/ajax/libs/babel-polyfill/6.26.0/polyfill.min.js',document.body.appendChild(e)),(e=document.createElement('script')).type='text/javascript',e.src='//html2canvas.hertzen.com/dist/html2canvas.min.js',document.body.appendChild(e),OPENPLATFORM.$screenshot=1}var n=function(){html2canvas(document.body).then(function(e){OPENPLATFORM.send('screenshot',e.toDataURL('image/jpeg',.85))})},t=setInterval(function(){window.html2canvas&&(clearInterval(t),n())},1e3)},OPENPLATFORM.launched=function(e){OPENPLATFORM.send('launched',null,e)},OPENPLATFORM.progress=function(e){return OPENPLATFORM.send('progress',e)},OPENPLATFORM.init=function(e){if(OPENPLATFORM.ready=!1,e||(e=function(e){null!=e?(document.body.innerHTML='401: Unauthorized',setTimeout(function(){window.close()},2e3)):OPENPLATFORM.ready=!0}),!OPENPLATFORM.is)return e(new Error('OpenPlatform isn\'t detected.')),void(document.body.innerHTML='401: Unauthorized');for(var n=location.search.substring(1).split('&'),t=null,o=0,r=n.length;o<r;o++){var O=n[o];if('openplatform='===O.substring(0,13)){var P=decodeURIComponent(O.substring(13));OPENPLATFORM.token=O.substring(13),t=decodeURIComponent(P.substring(P.indexOf('accesstoken=')+12));break}}var a={};a.ua=navigator.userAgent,OPENPLATFORM.accesstoken=t;var i=setTimeout(function(){i=null,e('timeout'),document.body.innerHTML='401: Unauthorized'},2e3);OPENPLATFORM.send('verify',a,function(n,t){i&&(clearTimeout(i),OPENPLATFORM.ready=!n,e(null,t,setTimeout(function(){t.href&&(location.href=t.href)},100))),i=null})},document.addEventListener('click',function(){OPENPLATFORM&&OPENPLATFORM.focus()}),OPENPLATFORM.loading=function(e,n){n?setTimeout(function(e){OPENPLATFORM.send('loading',e)},n,e):OPENPLATFORM.send('loading',e)},OPENPLATFORM.message=function(e,n){var t={};return t.body=e,t.type=n,OPENPLATFORM.send('message',t)},OPENPLATFORM.confirm=function(e,n,t){var o={};return o.body=e,o.buttons=n,OPENPLATFORM.send('confirm',o,t)},OPENPLATFORM.snackbar=function(e,n){var t={};return t.body=e,t.type=n,OPENPLATFORM.send('snackbar',t)},OPENPLATFORM.meta=function(e){var n={};n.ua=navigator.userAgent,n.accesstoken=OPENPLATFORM.accesstoken,OPENPLATFORM.send('meta',n,function(n,t){e(n,t)})},OPENPLATFORM.play=function(e){return/^(http|https):\/\//.test(e)||('/'!==e.substring(0,1)&&(e='/'+e),e=location.protocol+'//'+location.hostname+e),OPENPLATFORM.send('play',e)},OPENPLATFORM.stop=function(e){return OPENPLATFORM.send('stop',e)},OPENPLATFORM.focus=function(){return OPENPLATFORM.send('focus')},OPENPLATFORM.maximize=function(e){return OPENPLATFORM.send('maximize',e)},OPENPLATFORM.restart=function(){return OPENPLATFORM.send('restart',location.href)},OPENPLATFORM.open=function(e,n){return OPENPLATFORM.send('open',{id:e,data:n})},OPENPLATFORM.minimize=function(){return OPENPLATFORM.send('minimize')},OPENPLATFORM.badge=function(){return OPENPLATFORM.send('badge')},OPENPLATFORM.log=function(e){return OPENPLATFORM.send('log',e)},OPENPLATFORM.close=function(){return OPENPLATFORM.send('kill')},OPENPLATFORM.notify=function(e,n,t){return'string'==typeof e&&(t=n,n=e,e=0),OPENPLATFORM.send('notify',{type:e,body:n,data:t||'',datecreated:new Date})},OPENPLATFORM.share=function(e,n,t){return OPENPLATFORM.send('share',{app:'object'==typeof e?e.id:e,type:n,body:t,datecreated:new Date})},OPENPLATFORM.email=function(e,n){return OPENPLATFORM.send('email',{subject:e,body:n,datecreated:new Date})},OPENPLATFORM.send=function(e,n,t){'function'==typeof n&&(t=n,n=null);var o={};if(o.openplatform=!0,o.accesstoken=OPENPLATFORM.accesstoken,o.type=e,o.body=n||null,o.sender=!0,o.origin=location.protocol+'//'+location.hostname,top)return t&&(o.callback=(1e6*Math.random()).toString(32).replace(/\./g,''),OPENPLATFORM.callbacks[o.callback]=t),top.postMessage(JSON.stringify(o),'*'),OPENPLATFORM;t&&t(new Error('The application is not running in the OpenPlatform scope.'))},OPENPLATFORM.on=function(e,n){return!OPENPLATFORM.events[e]&&(OPENPLATFORM.events[e]=[]),OPENPLATFORM.events[e].push(n),OPENPLATFORM},OPENPLATFORM.$process=function(e){if(e.callback){var n=OPENPLATFORM.callbacks[e.callback];n&&(e.sender&&(e.error=new Error('The application is not running in the OpenPlatform scope.')),n(e.error,e.body||{}),delete OPENPLATFORM.callbacks[e.callback])}else if(!e.sender)if('reload'!==e.type)if('screenshotmake'!==e.type)if('redirect'!==e.type){'kill'===e.type&&(e.type='close'),'share'===e.type&&(e.body.share=function(e,n){OPENPLATFORM.share(this.app,e,n)});var t=OPENPLATFORM.events[e.type];t&&t.forEach(function(n){n(e.body||{})})}else location.href=e.body;else OPENPLATFORM.screenshot();else-1===location.href.indexOf('openplatform=')?location.href=OPENPLATFORM.tokenizator(location.href):location.reload(!0)},window.addEventListener('message',function(e){try{var n=JSON.parse(e.data);if(!n.openplatform)return;OPENPLATFORM.ready||'verify'===n.type?OPENPLATFORM.$process(n):OPENPLATFORM.pending.push(n)}catch(e){}},!1),OPENPLATFORM.tokenizator=function(e){var n=e.indexOf('?');return-1===n?e+'?openplatform='+OPENPLATFORM.token:e.substring(0,n+1)+'openplatform='+OPENPLATFORM.token+'&'+e.substring(n+1)};